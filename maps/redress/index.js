define(["esri/views/MapView","esri/layers/FeatureLayer","esri/Map","esri/PopupTemplate","esri/renderers/UniqueValueRenderer","dojo/dom","dojo/dom-style","esri/tasks/support/Query"],(function(e,t,a,r,s,i,n,o){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var l="#app-header-template",u="Racial Redress",p="Activities in America";var d="https://services9.arcgis.com/Wrm8WFKE8gOyMooJ/arcgis/rest/services/RedressWebMap_FeatureService_Public/FeatureServer",c=1,y=2,m=3,f=4,h="RedressTypeID",g=new t({title:"Racial Redress",url:d,layerId:0,outFields:["Title","Organization","Email","URL","Era","Injustice","Redress","Region","City","State","Country","StartDate","RedressTypeID","RegionID","InjusticeTypeID"],displayField:"Title",popupEnabled:!0}),w=new t({url:d,layerId:c}),b=new t({url:d,layerId:y}),v=new t({url:d,layerId:m}),T=new t({url:d,layerId:f}),R=new r({title:"{Title}",lastEditInfoEnabled:!1,expressionInfos:[{name:"EmailAddress",title:"EmailAddress",expression:'iif(IsEmpty($feature.Email), "Will be updated soon...", $feature.Email)'},{name:"RedressTypeRelated",title:"RedressTypeRelated",expression:"var related = FeatureSetByRelationshipName($feature, 'RedressType', ['Name'], false); return First(related).Name;"},{name:"InjusticeTypeRelated",title:"InjusticeTypeRelated",expression:"var related = FeatureSetByRelationshipName($feature, 'InjusticeType', ['Name'], false); return First(related).Name;"},{name:"RegionRelated",title:"RegionRelated",expression:"var related = FeatureSetByRelationshipName($feature, 'Region', ['Name'], false); return First(related).Name;"},{name:"YearsAgo",title:"YearsAgo",expression:'Text(Year(Now()) - $feature.StartDate, "#")'}],content:'        \n    <p><strong>Contact Information</strong></p>\n    <table>\n    <tr>\n    <td>Organization</td><td>{Organization}</td>\n    </tr>\n    <tr>\n    <td>Email address</td><td>{expression/EmailAddress}</td>\n    </tr>\n    <tr>\n    <td>Website</td><td><a href="{URL}">{URL}</td>\n    </tr>\n    </table>\n    <p><strong>Project Details</strong></p>\n    <table>\n    <tr>\n    <td>Historical Era</td><td>{Era}</td>\n    </tr>\n    <tr>\n    <td>Historical Injustice</td><td>{expression/InjusticeTypeRelated}</td>\n    </tr>\n    <tr>\n    <td>Historical Redress</td><td>{expression/RedressTypeRelated}</td>\n    </tr>\n    <td>Location</td><td>{City}, {State} ({expression/RegionRelated} region)</td>\n    </tr>\n    <td>Start date</td><td>{StartDate} ({expression/YearsAgo} years ago)</td>\n    </tr>\n    </table>\n  '});g.popupTemplate=R;var I=new s({field:h,defaultSymbol:void 0});b.queryFeatures({outFields:["ID","Color"],where:"1=1"}).then((function(e){var t=Object.keys(e.features).map((function(t){return{value:e.features[t].attributes.ID,symbol:{type:"picture-marker",url:"./images/all_maki_icons_"+e.features[t].attributes.Color+"/svgs/marker-15.svg",width:"15px",height:"15px"}}}));I.uniqueValueInfos=t,I.visualVariables=[{type:"size",valueExpression:"$view.zoom",legendOptions:{showLegend:!1},stops:[{size:8,value:4},{size:12,value:6},{size:14,value:8},{size:16,value:10}]}],g.renderer=I}));var D={featureLayers:{projectLayer:g,stateLayer:w},tableLayers:{redressTypeLayer:b,regionLayer:v,injusticeTypeLayer:T}},L=new a({basemap:"gray"});L.addMany([w,g]);var j="#widget-filter-template",V="#collapseFilter.collapse",O="spinner",E="toast";var x="#widget-legend-template";var F="viewDiv",S="#app-webmap-template",A="widgetFilter",N="top-right",q="widgetLegend",C="bottom-right",k="spinner",M="toast",P=new e({zoom:5,center:[-10671889.67355,4732499.934038251],padding:{top:0,bottom:0},popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,position:"top-left",breakpoint:{width:1200,height:1200}}},highlightOptions:{color:"steelblue",haloColor:"steelblue",haloOpacity:1,fillOpacity:1}}),z=function(e,t){return{template:j,props:{redressTypeValues:{type:Array,required:!0},injusticeTypeValues:{type:Array,required:!1},regionValues:{type:Array,required:!1}},data:function(){return{formData:{redressValue:"",injusticeValue:"",regionValue:""}}},methods:{filterSubmit:function(){var a=this;this.$emit(O,!0);var r="",s=[];""!==this.formData.redressValue&&(r="RedressTypeID = "+this.formData.redressValue,s.push(r)),""!==this.formData.injusticeValue&&(r="InjusticeTypeID = "+this.formData.injusticeValue,s.push(r)),""!==this.formData.regionValue&&(r="RegionID = "+this.formData.regionValue,s.push(r));var i=s.join(" AND ");t.definitionExpression=i;var n=new o({where:i});t.queryFeatureCount(n).then((function(r){r>0?t.queryExtent(n).then((function(t){e.goTo(t.extent),a.$emit(O,!1),$(V).collapse("toggle")})).catch((function(e){console.log("Error setting extent",e),a.$emit(O,!1),$(V).collapse("toggle")})):(a.$emit(E,{toastTitle:"No results",toastMessage:"Sorry, but your search returned no results. Please try again with different options.",toastAlertClass:"alert alert-warning"}),a.$emit(O,!1))}))}}}}(P,D.featureLayers.projectLayer);var _,W={toastDOM:"#appToast",toastDelay:3500};_={template:"#app-spinner-template",props:{isSpinning:{type:Boolean,required:!1}},data:function(){return{}},methods:{}},new Vue({el:"#app",components:{"app-header":{template:l,props:{},data:function(){return{title:u,subtitle:p}},methods:{}},"app-webmap":{template:S,props:{},components:{"widget-filter":z,"widget-legend":{template:x,props:{redressTypeValues:{type:Array,required:!0}},data:function(){return{}},methods:{getSVG:function(e){return console.log("data: ",e),"./images/all_maki_icons_"+e+"/svgs/marker-15.svg"}}}},data:function(){return{viewDiv:F,selectValues:{redressTypeValues:[],injusticeTypeValues:[],regionValues:[]}}},methods:{setLoading:function(e){this.$emit(k,e)},showToast:function(e){this.$emit(M,e)}},mounted:function(){var e=this,t={outFields:["*"],where:"1=1"};D.tableLayers.redressTypeLayer.queryFeatures(t).then((function(t){e.selectValues.redressTypeValues=t.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name,Color:e.attributes.Color}}))})),D.tableLayers.injusticeTypeLayer.queryFeatures(t).then((function(t){e.selectValues.injusticeTypeValues=t.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name}}))})),D.tableLayers.regionLayer.queryFeatures(t).then((function(t){e.selectValues.regionValues=t.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name}}))})),P.map=L,P.container=i.byId(this.viewDiv);var a=function(){var t=i.byId(A);P.ui.add(t,N),n.set(t,"display","block");var a=i.byId(q);P.ui.add(a,C),n.set(a,"display","block"),e.$emit(k,!1)};P.when((function(){D.featureLayers.stateLayer.when((function(){return D.featureLayers.stateLayer.queryExtent()})).then((function(e){P.goTo(e.extent)})),P.whenLayerView(D.featureLayers.projectLayer).then(a).catch((function(e){return console.error("Eror handling view.whenLayerView!",e)}))})).catch((function(e){console.error("Error handling view.when!",e)}))}},"app-spinner":_,"app-toast":{template:"#app-toast-template",props:{toastTitle:{type:String,required:!0},toastMessage:{type:String,required:!0},toastAlertClass:{type:String,required:!0}},data:function(){return{}},methods:{}}},data:{isLoading:!0,toastTitle:"This is a toast title",toastMessage:"Test",toastAlertClass:"alert alert-warning"},methods:{setLoading:function(e){this.isLoading=e},showToast:function(e){this.toastTitle=e.toastTitle,this.toastMessage=e.toastMessage,this.toastAlertClass=e.toastAlertClass,this.toast.toast("show")}},mounted:function(){this.toast=$(W.toastDOM).toast({delay:W.toastDelay})}})}));
