define(["esri/views/MapView","esri/layers/FeatureLayer","esri/Map","esri/PopupTemplate","esri/renderers/UniqueValueRenderer","dojo/dom","dojo/dom-style","esri/tasks/support/Query"],(function(e,t,a,r,s,i,n,o){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var l="https://services9.arcgis.com/Wrm8WFKE8gOyMooJ/arcgis/rest/services/RedressWebMap_FeatureService_Public/FeatureServer",u=1,d=2,p=3,c=4,y="RedressTypeID",m={1:"154360",2:"f4d03f",3:"bb8fce",4:"cb4335",5:"784212",6:"145a32"},f=new t({title:"Racial Redress",url:l,layerId:0,outFields:["Title","Organization","Email","URL","Era","Injustice","Redress","Region","City","State","Country","StartDate","RedressTypeID","RegionID","InjusticeTypeID"],displayField:"Title",popupEnabled:!0}),g=new t({url:l,layerId:u}),h=new t({url:l,layerId:d}),b=new t({url:l,layerId:p}),w=new t({url:l,layerId:c}),v=new r({title:"{Title}",lastEditInfoEnabled:!1,expressionInfos:[{name:"EmailAddress",title:"EmailAddress",expression:'iif(IsEmpty($feature.Email), "Will be updated soon...", $feature.Email)'},{name:"RedressTypeRelated",title:"RedressTypeRelated",expression:"var related = FeatureSetByRelationshipName($feature, 'RedressType', ['Name'], false); return First(related).Name;"},{name:"InjusticeTypeRelated",title:"InjusticeTypeRelated",expression:"var related = FeatureSetByRelationshipName($feature, 'InjusticeType', ['Name'], false); return First(related).Name;"},{name:"RegionRelated",title:"RegionRelated",expression:"var related = FeatureSetByRelationshipName($feature, 'Region', ['Name'], false); return First(related).Name;"},{name:"YearsAgo",title:"YearsAgo",expression:'Text(Year(Now()) - $feature.StartDate, "#")'}],content:'        \n    <p><strong>Contact Information</strong></p>\n    <table>\n    <tr>\n    <td>Organization</td><td>{Organization}</td>\n    </tr>\n    <tr>\n    <td>Email address</td><td>{expression/EmailAddress}</td>\n    </tr>\n    <tr>\n    <td>Website</td><td><a href="{URL}">{URL}</td>\n    </tr>\n    </table>\n    <p><strong>Project Details</strong></p>\n    <table>\n    <tr>\n    <td>Historical Era</td><td>{Era}</td>\n    </tr>\n    <tr>\n    <td>Historical Injustice</td><td>{expression/InjusticeTypeRelated}</td>\n    </tr>\n    <tr>\n    <td>Historical Redress</td><td>{expression/RedressTypeRelated}</td>\n    </tr>\n    <td>Location</td><td>{City}, {State} ({expression/RegionRelated} region)</td>\n    </tr>\n    <td>Start date</td><td>{StartDate} ({expression/YearsAgo} years ago)</td>\n    </tr>\n    </table>\n  '});f.popupTemplate=v;var I=new s({field:y,defaultSymbol:void 0,uniqueValueInfos:Object.keys(m).map((function(e){return{value:e,symbol:{type:"picture-marker",url:"./images/all_maki_icons_"+m[e]+"/svgs/marker-15.svg",width:"15px",height:"15px"}}}))});I.visualVariables=[{type:"size",valueExpression:"$view.zoom",legendOptions:{showLegend:!1},stops:[{size:8,value:4},{size:12,value:6},{size:14,value:8},{size:16,value:10}]}],f.renderer=I;var T={featureLayers:{projectLayer:f,stateLayer:g},tableLayers:{redressTypeLayer:h,regionLayer:b,injusticeTypeLayer:w}},R=new a({basemap:"gray"});R.addMany([g,f]);var L="#widget-filter-template";var D="#widget-legend-template";!function(e){var t={template:"#app-header-template",props:{},data:function(){return{title:"Racial Redress",subtitle:"Activities in America"}},methods:{}},a={template:"#app-webmap-template",props:{},data:function(){return{viewDiv:"viewDiv"}},methods:{}},r=function(e,t,a){return{template:L,props:{},data:function(){return{formData:{redressValue:"",injusticeValue:"",regionValue:""},selectValues:{redressTypeValues:[],injusticeTypeValues:[],regionValues:[]}}},methods:{filterSubmit:function(){var a=this;this.$emit("spinner",!0);var r="",s=[];""!==this.formData.redressValue&&(r="RedressTypeID = "+this.formData.redressValue,s.push(r)),""!==this.formData.injusticeValue&&(r="InjusticeTypeID = "+this.formData.injusticeValue,s.push(r)),""!==this.formData.regionValue&&(r="RegionID = "+this.formData.regionValue,s.push(r));var i=s.join(" AND ");t.definitionExpression=i;var n=new o({where:i});t.queryFeatureCount(n).then((function(r){r>0?t.queryExtent(n).then((function(t){e.goTo(t.extent),a.$emit("spinner",!1),$("#collapseFilter.collapse").collapse("toggle")})).catch((function(e){console.log("Error setting extent",e),a.$emit("spinner",!1),$("#collapseFilter.collapse").collapse("toggle")})):(a.$emit("toast",{toastTitle:"No results",toastMessage:"Sorry, but your search returned no results. Please try again with different options.",toastAlertClass:"alert alert-warning"}),a.$emit("spinner",!1))}))}},created:function(){var e=this,t={outFields:["ID","Name"],where:"1=1"};a.redressTypeLayer.queryFeatures(t).then((function(t){e.selectValues.redressTypeValues=t.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name}}))})),a.regionLayer.queryFeatures(t).then((function(t){e.selectValues.regionValues=t.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name}}))})),a.injusticeTypeLayer.queryFeatures(t).then((function(t){e.selectValues.injusticeTypeValues=t.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name}}))}))}}}(e,T.featureLayers.projectLayer,T.tableLayers),s=function(e){return{template:D,props:{},data:function(){return{legendItems:[],markerColors:{1:"154360",2:"f4d03f",3:"bb8fce",4:"cb4335",5:"784212",6:"145a32"}}},methods:{getSVG:function(e){return console.log("data: ",e),"./images/all_maki_icons_"+this.markerColors[e.toString()]+"/svgs/marker-15.svg"}},created:function(){var t=this;e.queryFeatures({outFields:["ID","Name"],where:"1=1"}).then((function(e){t.legendItems=e.features.map((function(e){return{ID:e.attributes.ID,Name:e.attributes.Name}}))}))}}}(T.tableLayers.redressTypeLayer),l={template:"#app-spinner-template",props:{isSpinning:{type:Boolean,required:!1}},data:function(){return{}},methods:{}};new Vue({el:"#app",components:{"app-header":t,"app-webmap":a,"widget-filter":r,"widget-legend":s,"app-spinner":l,"app-toast":{template:"#app-toast-template",props:{toastTitle:{type:String,required:!0},toastMessage:{type:String,required:!0},toastAlertClass:{type:String,required:!0}},data:function(){return{}},methods:{}}},data:{isLoading:!0,toastTitle:"This is a toast title",toastMessage:"Quae cum dixisset paulumque institisset, Quid est? Sed ad bona praeterita redeamus. Scrupulum, inquam, abeunti; Hoc non est positum in nostra actione. An tu me de L.",toastAlertClass:"alert-warning",toast:""},methods:{setLoading:function(e){this.isLoading=e},showToast:function(e){console.log(e),this.toastTitle=e.toastTitle,this.toastMessage=e.toastMessage,this.toastAlertClass=e.toastAlertClass,console.log(this.toastTitle+" -- "+this.toastMessage+" -- "+this.toastAlertClass),this.toast.toast("show")}},mounted:function(){var t=this;this.toast=$("#appToast").toast({delay:3500}),e.map=R,e.container=i.byId("viewDiv");var a=function(){var a=i.byId("widgetFilter");e.ui.add(a,"top-right"),n.set(a,"display","block");var r=i.byId("widgetLegend");e.ui.add(r,"bottom-right"),n.set(r,"display","block"),t.isLoading=!1};e.when((function(){T.featureLayers.stateLayer.when((function(){return T.featureLayers.stateLayer.queryExtent()})).then((function(t){e.goTo(t.extent)})),e.whenLayerView(T.featureLayers.projectLayer).then(a).catch((function(e){return console.error("Eror handling view.whenLayerView!",e)}))})).catch((function(e){console.error("Error handling view.when!",e)}))}})}(new e({zoom:5,center:[-10671889.67355,4732499.934038251],padding:{top:0,bottom:0},popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,position:"top-left",breakpoint:{width:1200,height:1200}}},highlightOptions:{color:"steelblue",haloColor:"steelblue",haloOpacity:1,fillOpacity:1}}))}));
